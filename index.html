<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<title>Tap-to-Fly Game</title>
<style>
  html, body {
    margin: 0;
    padding: 0;
    overflow: hidden;
    background: linear-gradient(#70c5ce, #ffffff);
    height: 100%;
    width: 100%;
    touch-action: none; /* Supaya tap tidak scroll halaman */
  }
  canvas {
    display: block;
    background: linear-gradient(#70c5ce, #d0f4f7);
    margin: auto;
    position: absolute;
    inset: 0;
  }
  #overlay {
    position: absolute;
    inset: 0;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    color: #222;
    font-family: Arial, sans-serif;
    background: rgba(255,255,255,0.7);
    text-align: center;
  }
  #btnStart {
    background: #ffcc00;
    padding: 0.6em 1.4em;
    border: none;
    border-radius: 12px;
    margin-top: 1em;
    font-size: 1.1em;
    font-weight: bold;
    box-shadow: 0 3px 0 #b58a00;
  }
  #btnStart:active {
    transform: translateY(2px);
    box-shadow: 0 1px 0 #b58a00;
  }
</style>
</head>
<body>
<canvas id="gameCanvas"></canvas>
<div id="overlay">
  <div id="title" style="font-size:2em;font-weight:bold;">Tap-to-Fly</div>
  <button id="btnStart">Mulai Game</button>
  <p style="font-size:1em;">Ketuk layar untuk terbang!</p>
</div>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

let W, H;
function resize() {
  W = window.innerWidth;
  H = window.innerHeight;
  canvas.width = W;
  canvas.height = H;
}
resize();
window.addEventListener("resize", resize);

// CONFIG
const G = 0.6;
const FLAP = -10;
const PIPE_GAP = 140;
const PIPE_SPEED = 2.5;
const PIPE_INTERVAL = 1500;

// Game state
let bird, pipes, score, highScore = localStorage.getItem("highscore") || 0;
let lastPipeTime = 0;
let running = false;
let gameOver = false;

// Bird
function resetGame() {
  bird = { x: W * 0.3, y: H / 2, vy: 0, r: 15 };
  pipes = [];
  score = 0;
  gameOver = false;
  lastPipeTime = performance.now();
}

function drawBird() {
  ctx.save();
  ctx.translate(bird.x, bird.y);
  ctx.rotate(Math.min(Math.max(bird.vy / 10, -0.5), 0.5));
  ctx.fillStyle = "#ffeb3b";
  ctx.beginPath();
  ctx.arc(0, 0, bird.r, 0, Math.PI * 2);
  ctx.fill();
  ctx.restore();
}

function flap() {
  if (!running) return;
  if (gameOver) return;
  bird.vy = FLAP;
}

// Pipes
function addPipe() {
  const gapY = Math.random() * (H - PIPE_GAP - 200) + 100;
  pipes.push({ x: W, y: gapY });
}

function update() {
  if (!running || gameOver) return;

  // Bird physics
  bird.vy += G;
  if (bird.vy > 12) bird.vy = 12;
  bird.y += bird.vy;

  // Add pipes
  if (performance.now() - lastPipeTime > PIPE_INTERVAL) {
    addPipe();
    lastPipeTime = performance.now();
  }

  // Update pipes
  for (let i = pipes.length - 1; i >= 0; i--) {
    pipes[i].x -= PIPE_SPEED;
    if (pipes[i].x + 60 < 0) {
      pipes.splice(i, 1);
      score++;
      if (score > highScore) {
        highScore = score;
        localStorage.setItem("highscore", highScore);
      }
    }
  }

  // Collision
  for (const p of pipes) {
    if (
      bird.x + bird.r > p.x && bird.x - bird.r < p.x + 60 &&
      (bird.y - bird.r < p.y || bird.y + bird.r > p.y + PIPE_GAP)
    ) {
      gameOver = true;
    }
  }
  if (bird.y + bird.r > H || bird.y - bird.r < 0) gameOver = true;
}

function draw() {
  ctx.clearRect(0, 0, W, H);

  // Pipes
  ctx.fillStyle = "#4caf50";
  for (const p of pipes) {
    ctx.fillRect(p.x, 0, 60, p.y);
    ctx.fillRect(p.x, p.y + PIPE_GAP, 60, H - p.y - PIPE_GAP);
  }

  // Bird
  drawBird();

  // Ground
  ctx.fillStyle = "#795548";
  ctx.fillRect(0, H - 20, W, 20);

  // Score
  ctx.fillStyle = "#000";
  ctx.font = "bold 24px Arial";
  ctx.fillText("Score: " + score, 20, 40);
  ctx.fillText("Best: " + highScore, 20, 70);

  if (gameOver) {
    ctx.fillStyle = "rgba(0,0,0,0.5)";
    ctx.fillRect(0, 0, W, H);
    ctx.fillStyle = "#fff";
    ctx.font = "bold 36px Arial";
    ctx.fillText("GAME OVER", W/2 - 110, H/2 - 20);
    ctx.font = "20px Arial";
    ctx.fillText("Skor: " + score, W/2 - 40, H/2 + 10);
    ctx.fillText("Ketuk untuk main lagi", W/2 - 110, H/2 + 40);
  }
}

function loop() {
  update();
  draw();
  requestAnimationFrame(loop);
}

// Input
function handleInput() {
  if (!running) return;
  if (gameOver) {
    startGame();
  } else {
    flap();
  }
}

canvas.addEventListener("touchstart", e => {
  e.preventDefault();
  handleInput();
}, { passive: false });

canvas.addEventListener("mousedown", handleInput);
window.addEventListener("keydown", e => {
  if (e.code === "Space" || e.code === "ArrowUp") handleInput();
});

// Overlay
const overlay = document.getElementById("overlay");
const btnStart = document.getElementById("btnStart");
btnStart.onclick = () => startGame();

function startGame() {
  overlay.style.display = "none";
  running = true;
  resetGame();
}

resetGame();
loop();
</script>
</body>
</html>
